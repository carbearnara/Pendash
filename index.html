<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pendash - Pendle Yield Analysis</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <header class="header">
            <a href="#" class="logo" id="logo-home" title="Return to home">
                <svg class="logo-icon" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logo-grad" x1="0%" y1="100%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#2DD4BF"/>
                            <stop offset="50%" style="stop-color:#A78BFA"/>
                            <stop offset="100%" style="stop-color:#F472B6"/>
                        </linearGradient>
                    </defs>
                    <path d="M6 22 Q10 22, 13 18 T20 10 L26 6" fill="none" stroke="url(#logo-grad)" stroke-width="2.5" stroke-linecap="round"/>
                    <circle cx="13" cy="18" r="2.5" fill="#2DD4BF"/>
                    <circle cx="20" cy="10" r="2.5" fill="#A78BFA"/>
                </svg>
                <span class="logo-text">Pendash</span>
            </a>
            <div class="header-controls">
                <button class="theme-toggle" id="theme-toggle" title="Toggle light/dark mode">
                    <svg class="theme-icon sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="theme-icon moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
                <p class="tagline">Pendle Yield Analysis</p>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab active" data-tab="markets">Live Markets</button>
            <button class="tab" data-tab="calculator">Analysis</button>
            <button class="tab" data-tab="compare">Strategy Compare</button>
        </nav>

        <main class="content">
            <!-- Live Markets -->
            <section id="markets-calculator" class="calculator-section active">
                <div class="section-header">
                    <h2>Live Pendle Markets</h2>
                    <p>Real-time data from Pendle. Click a market to analyze.</p>
                </div>

                <div class="filters">
                    <div class="filter-group search-group">
                        <label>Search</label>
                        <div class="search-wrapper">
                            <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            <input type="text" id="search-filter" placeholder="Search assets...">
                            <button class="search-clear" id="search-clear" title="Clear search">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 6L6 18M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Chain</label>
                        <select id="chain-filter">
                            <option value="1">Ethereum</option>
                            <option value="42161">Arbitrum</option>
                            <option value="8453">Base</option>
                            <option value="56">BNB Chain</option>
                            <option value="146">Sonic</option>
                            <option value="999">HyperEVM</option>
                            <option value="9745">Plasma</option>
                            <option value="5000">Mantle</option>
                            <option value="10">Optimism</option>
                            <option value="80094">Berachain</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Sort by</label>
                        <select id="sort-filter">
                            <option value="underlyingApy">Underlying APY</option>
                            <option value="tvl">TVL</option>
                            <option value="lpApy">LP APY</option>
                            <option value="fixedApy">Fixed APY</option>
                            <option value="impliedApy">Implied APY</option>
                            <option value="expiry">Expiry</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Show</label>
                        <select id="signal-filter">
                            <option value="all">All Markets</option>
                            <option value="pt-opportunity">PT Opportunities</option>
                            <option value="yt-opportunity">YT Opportunities</option>
                            <option value="lp-opportunity">LP Opportunities</option>
                            <option value="loop-opportunity">Loop Opportunities</option>
                            <option value="has-incentives">With Incentives</option>
                            <option value="no-incentives">No Incentives</option>
                            <option value="pure-points">Pure Points (0% Underlying)</option>
                            <option value="real-yield">Real Yield Only</option>
                            <option value="below-watermark">Below Watermark</option>
                        </select>
                    </div>
                    <button class="refresh-btn" id="refresh-markets">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 4v6h6M23 20v-6h-6"/>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                        </svg>
                        Refresh
                    </button>
                </div>

                <div class="market-legend">
                    <button class="legend-btn active" data-filter="pt" title="Click to toggle, double-click to isolate">
                        <span class="signal-dot pt-signal"></span>
                        <span>PT Opportunity</span>
                    </button>
                    <button class="legend-btn active" data-filter="yt" title="Click to toggle, double-click to isolate">
                        <span class="signal-dot yt-signal"></span>
                        <span>YT Opportunity</span>
                    </button>
                    <button class="legend-btn active" data-filter="lp" title="Click to toggle, double-click to isolate">
                        <span class="signal-dot lp-signal"></span>
                        <span>LP Opportunity</span>
                    </button>
                    <button class="legend-btn active" data-filter="loop" title="Click to toggle, double-click to isolate">
                        <span class="signal-dot loop-signal"></span>
                        <span>Loop Opportunity</span>
                    </button>
                    <button class="legend-btn active" data-filter="neutral" title="Click to toggle, double-click to isolate">
                        <span class="signal-dot neutral-signal"></span>
                        <span>Neutral</span>
                    </button>
                    <button class="legend-btn active" data-filter="watermark" title="Click to toggle, double-click to isolate">
                        <span class="signal-dot watermark-signal"></span>
                        <span>Below Watermark</span>
                    </button>
                </div>

                <div class="markets-table-header" id="markets-header">
                    <div class="header-cell market-info-header">Asset</div>
                    <div class="header-cell sortable" data-sort="tvl">TVL <span class="sort-arrow">‚Üì</span></div>
                    <div class="header-cell sortable" data-sort="underlyingApy">Underlying <span class="sort-arrow"></span></div>
                    <div class="header-cell sortable" data-sort="impliedApy">Implied <span class="sort-arrow"></span></div>
                    <div class="header-cell sortable" data-sort="fixedApy">Fixed APY <span class="sort-arrow"></span></div>
                    <div class="header-cell sortable" data-sort="lpApy">LP APY <span class="sort-arrow"></span></div>
                    <div class="header-cell">Signal</div>
                </div>
                <div class="markets-container" id="markets-list">
                    <div class="loading">Loading markets...</div>
                </div>
            </section>

            <!-- Calculator -->
            <section id="calculator-calculator" class="calculator-section">
                <div class="section-header">
                    <div class="section-header-main">
                        <h2>Position Analysis</h2>
                        <p>Analyze returns for PT, YT, LP, or Loop positions</p>
                    </div>
                    <button class="nav-link-btn" id="browse-markets-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Browse Markets
                    </button>
                </div>

                <!-- No Market Selected Prompt -->
                <div class="no-market-prompt" id="no-market-prompt">
                    <div class="prompt-card">
                        <div class="prompt-icon-large">üìä</div>
                        <h3>Select a Market to Analyze</h3>
                        <p>Choose a market from Live Markets to see detailed calculations, historical data, and strategy recommendations.</p>
                        <button class="select-market-btn" id="select-market-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            Browse Live Markets
                        </button>
                        <p class="prompt-hint">Or enter custom values below to calculate manually</p>
                    </div>
                </div>

                <div class="selected-market-banner" id="selected-market-banner" style="display: none;">
                    <div class="banner-content">
                        <img id="banner-icon" src="" alt="" class="banner-icon">
                        <div class="banner-info">
                            <span class="banner-name" id="banner-name">-</span>
                            <span class="banner-expiry" id="banner-expiry">-</span>
                        </div>
                    </div>
                    <div class="banner-actions">
                        <a id="pendle-pt-link" href="#" target="_blank" class="pendle-link pt-link" title="Trade PT on Pendle">Buy PT</a>
                        <a id="pendle-yt-link" href="#" target="_blank" class="pendle-link yt-link" title="Trade YT on Pendle">Buy YT</a>
                        <a id="pendle-lp-link" href="#" target="_blank" class="pendle-link lp-link" title="Provide LP on Pendle">Add LP</a>
                        <span class="loop-links" id="loop-links" style="display: none;">
                            <span class="loop-divider">|</span>
                            <a id="loop-aave-link" href="#" target="_blank" class="pendle-link loop-link" title="Loop on Aave V3" style="display: none;">Aave</a>
                            <a id="loop-morpho-link" href="#" target="_blank" class="pendle-link loop-link" title="Loop on Morpho" style="display: none;">Morpho</a>
                            <a id="loop-euler-link" href="#" target="_blank" class="pendle-link loop-link" title="Loop on Euler" style="display: none;">Euler</a>
                        </span>
                        <button class="banner-action-btn" id="compare-strategies-btn" title="Compare all strategies">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <path d="M18 20V10M12 20V4M6 20v-6"/>
                            </svg>
                            Compare
                        </button>
                        <button class="banner-clear" id="clear-selection">Clear</button>
                    </div>
                </div>

                <div class="calculator-grid">
                    <div class="input-card">
                        <h3>Position Parameters</h3>

                        <div class="input-group">
                            <label for="calc-position-type">Position Type</label>
                            <div class="toggle-group">
                                <button class="toggle-btn active" data-type="pt">Buy PT</button>
                                <button class="toggle-btn" data-type="yt">Buy YT</button>
                                <button class="toggle-btn" data-type="lp">Provide LP</button>
                                <button class="toggle-btn" data-type="loop">Loop PT</button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="calc-pt-price">PT Price</label>
                            <div class="input-wrapper">
                                <input type="number" id="calc-pt-price" value="0.95" step="0.001" min="0" max="1">
                                <span class="input-suffix">per underlying</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="calc-yt-price">YT Price</label>
                            <div class="input-wrapper">
                                <input type="number" id="calc-yt-price" value="0.05" step="0.001" min="0" max="1">
                                <span class="input-suffix">per underlying</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="calc-days">Days to Maturity</label>
                            <div class="input-wrapper">
                                <input type="number" id="calc-days" value="90" step="1" min="1" max="730">
                                <span class="input-suffix">days</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="calc-underlying-apy">Underlying APY (current)</label>
                            <div class="input-wrapper">
                                <input type="number" id="calc-underlying-apy" value="5" step="0.1" min="0">
                                <span class="input-suffix">%</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="calc-expected-apy">Expected Future APY</label>
                            <div class="input-wrapper">
                                <input type="number" id="calc-expected-apy" value="5" step="0.1" min="0">
                                <span class="input-suffix">%</span>
                            </div>
                            <span class="input-hint">Your prediction for average APY until maturity</span>
                        </div>

                        <div class="input-group">
                            <label for="calc-investment">Investment Amount</label>
                            <div class="input-wrapper">
                                <input type="number" id="calc-investment" value="10000" step="100" min="0">
                                <span class="input-suffix">USD</span>
                            </div>
                        </div>
                    </div>

                    <div class="results-card">
                        <h3>Analysis</h3>

                        <div class="valuation-signal" id="valuation-signal">
                            <div class="signal-header">
                                <span class="signal-icon">‚öñÔ∏è</span>
                                <span class="signal-title">Market Signal</span>
                            </div>
                            <div class="signal-body" id="signal-body">
                                Analyzing...
                            </div>
                        </div>

                        <div class="result-item highlight">
                            <span class="result-label">Implied APY</span>
                            <span class="result-value" id="calc-implied-apy">21.55%</span>
                        </div>

                        <div class="apy-comparison">
                            <div class="apy-bar-container">
                                <div class="apy-bar underlying-bar" id="underlying-bar"></div>
                                <div class="apy-bar implied-bar" id="implied-bar"></div>
                            </div>
                            <div class="apy-labels">
                                <span>Underlying: <strong id="underlying-label">5%</strong></span>
                                <span>Implied: <strong id="implied-label">21.55%</strong></span>
                            </div>
                        </div>

                        <div class="results-divider"></div>

                        <div id="pt-results">
                            <div class="result-item">
                                <span class="result-label">Fixed APY (PT)</span>
                                <span class="result-value" id="calc-fixed-apy">21.55%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">PT Discount</span>
                                <span class="result-value" id="calc-pt-discount">5.00%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Value at Maturity</span>
                                <span class="result-value" id="calc-pt-maturity">$10,526.32</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Guaranteed Profit</span>
                                <span class="result-value profit" id="calc-pt-profit">+$526.32</span>
                            </div>
                        </div>

                        <div id="yt-results" style="display: none;">
                            <div class="result-item">
                                <span class="result-label">Leverage</span>
                                <span class="result-value" id="calc-yt-leverage">20x</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Yield Exposure</span>
                                <span class="result-value" id="calc-yt-exposure">$200,000</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Break-even APY</span>
                                <span class="result-value" id="calc-breakeven">21.55%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Expected Yield (net)</span>
                                <span class="result-value" id="calc-yt-yield">$2,342.47</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Expected P&L</span>
                                <span class="result-value" id="calc-yt-pnl">+$1,342.47</span>
                            </div>
                        </div>

                        <div id="lp-results" style="display: none;">
                            <div class="result-item">
                                <span class="result-label">LP APY (Total)</span>
                                <span class="result-value" id="calc-lp-apy">15.50%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">PT Exposure</span>
                                <span class="result-value" id="calc-lp-pt-exposure">~50%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Swap Fee APY</span>
                                <span class="result-value" id="calc-lp-swap-apy">2.50%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Incentive APY</span>
                                <span class="result-value" id="calc-lp-incentive-apy">5.00%</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Expected Value</span>
                                <span class="result-value profit" id="calc-lp-value">$10,381.64</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">IL Risk</span>
                                <span class="result-value" id="calc-lp-il-risk">Low-Medium</span>
                            </div>
                        </div>

                        <div id="loop-results" style="display: none;">
                            <div class="loop-available" id="loop-available">
                                <div class="result-item highlight-loop">
                                    <span class="result-label">Effective APY (Looped)</span>
                                    <span class="result-value loop-highlight" id="calc-loop-effective-apy">-</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Base PT Fixed APY</span>
                                    <span class="result-value" id="calc-loop-base-apy">-</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">APY Boost</span>
                                    <span class="result-value profit" id="calc-loop-boost">-</span>
                                </div>
                                <div class="results-divider"></div>
                                <div class="result-item">
                                    <span class="result-label">Platform</span>
                                    <span class="result-value" id="calc-loop-platform">-</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">LTV / Leverage</span>
                                    <span class="result-value" id="calc-loop-leverage">-</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Borrow Rate</span>
                                    <span class="result-value" id="calc-loop-borrow-rate">-</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Liquidation Buffer</span>
                                    <span class="result-value" id="calc-loop-liq-buffer">-</span>
                                </div>
                                <div class="results-divider"></div>
                                <div class="result-item">
                                    <span class="result-label">Expected Value</span>
                                    <span class="result-value profit" id="calc-loop-value">-</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">Expected Profit</span>
                                    <span class="result-value profit" id="calc-loop-profit">-</span>
                                </div>
                                <div class="result-item">
                                    <span class="result-label">vs Regular PT</span>
                                    <span class="result-value" id="calc-loop-vs-pt">-</span>
                                </div>
                                <div class="loop-warning">
                                    <strong>Liquidation Risk:</strong> Monitor your position. Max drawdown determines liquidation risk.
                                </div>
                            </div>
                            <div class="loop-unavailable" id="loop-unavailable" style="display: none;">
                                <div class="loop-no-opportunity">
                                    <p>No loop opportunity available for this market.</p>
                                    <p class="hint">Loop opportunities require PT to be listed as collateral on Aave V3 or Morpho Blue.</p>
                                </div>
                            </div>
                        </div>

                        <div class="results-divider"></div>

                        <div class="result-item">
                            <span class="result-label">vs Holding Underlying</span>
                            <span class="result-value" id="calc-vs-hold">+$402.74</span>
                        </div>
                    </div>
                </div>

                <!-- Loop Oracle Analysis (shown when Loop PT selected) -->
                <div class="loop-oracle-section" id="loop-oracle-section" style="display: none;">
                    <!-- Prompt to select a market -->
                    <div class="loop-select-prompt" id="loop-select-prompt">
                        <div class="looping-card">
                            <div class="loop-prompt-content">
                                <div class="prompt-icon">üîÑ</div>
                                <h3>Select a Loop Opportunity</h3>
                                <p>To see oracle analysis and PT price history, select a market with the <span class="loop-badge-inline">Loop</span> badge from the Live Markets tab.</p>
                                <button class="view-loop-btn" id="view-loop-btn">View Loop Opportunities</button>
                            </div>
                        </div>
                    </div>

                    <!-- Oracle Analysis Content -->
                    <div class="loop-oracle-content" id="loop-oracle-content" style="display: none;">
                    <div class="looping-card oracle-card">
                        <h3>Oracle Analysis</h3>
                        <div class="oracle-header" id="oracle-header">
                            <span class="oracle-icon" id="oracle-icon">-</span>
                            <div class="oracle-title">
                                <span class="oracle-type" id="oracle-type">-</span>
                                <span class="oracle-provider" id="oracle-provider">Provider: -</span>
                            </div>
                            <span class="oracle-stability-badge" id="oracle-stability-badge">-</span>
                        </div>
                        <div class="oracle-description" id="oracle-description">
                            Select a market to see oracle details.
                        </div>
                        <div class="oracle-metrics">
                            <div class="oracle-metric">
                                <span class="metric-label">Price Type</span>
                                <span class="metric-value" id="oracle-price-type">-</span>
                            </div>
                            <div class="oracle-metric">
                                <span class="metric-label">TWAP Window</span>
                                <span class="metric-value" id="oracle-twap-window">-</span>
                            </div>
                            <div class="oracle-metric">
                                <span class="metric-label">Stability Rating</span>
                                <span class="metric-value" id="oracle-stability-rating">-</span>
                            </div>
                            <div class="oracle-metric">
                                <span class="metric-label">Risk Level</span>
                                <span class="metric-value" id="oracle-risk-level">-</span>
                            </div>
                        </div>
                        <div class="oracle-risk-summary" id="oracle-risk-summary">
                            <span class="risk-icon">-</span>
                            <span class="risk-text">-</span>
                        </div>
                        <div class="oracle-chart-container" id="oracle-chart-container">
                            <h4>PT Price History (90 Days)</h4>
                            <div class="oracle-chart-loading" id="oracle-chart-loading">Loading historical data...</div>
                            <canvas id="oracle-price-chart"></canvas>
                            <div class="oracle-chart-stats" id="oracle-chart-stats">
                                <div class="chart-stat">
                                    <span class="stat-label">Current</span>
                                    <span class="stat-value" id="oracle-price-current">-</span>
                                </div>
                                <div class="chart-stat">
                                    <span class="stat-label">90D Min</span>
                                    <span class="stat-value" id="oracle-price-min">-</span>
                                </div>
                                <div class="chart-stat">
                                    <span class="stat-label">90D Max</span>
                                    <span class="stat-value" id="oracle-price-max">-</span>
                                </div>
                                <div class="chart-stat">
                                    <span class="stat-label">Volatility</span>
                                    <span class="stat-value" id="oracle-price-volatility">-</span>
                                </div>
                                <div class="chart-stat drawdown-stat">
                                    <span class="stat-label">Max Drawdown</span>
                                    <span class="stat-value" id="oracle-price-drawdown">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                <!-- Historical Yield Range -->
                <div class="history-card" id="history-card" style="display: none;">
                    <h3 id="history-title">Historical Yield Range</h3>
                    <p class="history-subtitle" id="history-subtitle"></p>
                    <div class="history-loading" id="history-loading">Loading historical data...</div>
                    <div class="history-content" id="history-content" style="display: none;">
                        <div class="yield-range-section">
                            <h4>Implied APY (YT Pricing)</h4>
                            <div class="range-viz">
                                <div class="range-bar">
                                    <div class="range-fill" id="implied-range-fill"></div>
                                    <div class="range-marker" id="implied-marker"></div>
                                </div>
                                <div class="range-stats">
                                    <span class="range-min" id="implied-min">0%</span>
                                    <span class="range-current" id="implied-current">Current: 5%</span>
                                    <span class="range-max" id="implied-max">20%</span>
                                </div>
                            </div>
                            <div class="range-info">
                                <span class="percentile-label">Percentile: <strong id="implied-percentile">50th</strong></span>
                                <span class="position-label" id="implied-position">Average</span>
                            </div>
                        </div>

                        <div class="yield-range-section">
                            <h4>Underlying APY (Realized Yield)</h4>
                            <div class="range-viz">
                                <div class="range-bar">
                                    <div class="range-fill" id="underlying-range-fill"></div>
                                    <div class="range-marker" id="underlying-marker"></div>
                                </div>
                                <div class="range-stats">
                                    <span class="range-min" id="underlying-min">0%</span>
                                    <span class="range-current" id="underlying-current">Current: 5%</span>
                                    <span class="range-max" id="underlying-max">20%</span>
                                </div>
                            </div>
                            <div class="range-info">
                                <span class="percentile-label">Percentile: <strong id="underlying-percentile">50th</strong></span>
                                <span class="position-label" id="underlying-position">Average</span>
                            </div>
                        </div>

                        <div class="yield-spread-section">
                            <h4>Implied vs Underlying Spread</h4>
                            <div class="spread-indicator">
                                <span class="spread-value" id="spread-value">+2.5%</span>
                                <span class="spread-label" id="spread-label">Implied above Underlying (PT favorable)</span>
                            </div>
                        </div>

                        <div class="history-chart-container">
                            <h4 id="history-chart-title">Yield History</h4>
                            <canvas id="history-chart"></canvas>
                        </div>

                        <div class="advanced-analytics">
                            <h4>Advanced Analytics</h4>

                            <div class="analytics-grid">
                                <div class="analytics-card">
                                    <div class="analytics-header">
                                        <span class="analytics-title">Mean Reversion</span>
                                                                            </div>
                                    <div class="analytics-body" id="mean-reversion-analysis">
                                        <div class="analysis-detail">Calculating...</div>
                                    </div>
                                </div>

                                <div class="analytics-card">
                                    <div class="analytics-header">
                                        <span class="analytics-title">Cross-Asset Comparison</span>
                                                                            </div>
                                    <div class="analytics-body" id="cross-asset-analysis">
                                        <div class="analysis-detail">Calculating...</div>
                                    </div>
                                </div>

                                <div class="analytics-card">
                                    <div class="analytics-header">
                                        <span class="analytics-title">Risk-Adjusted Returns (Sharpe)</span>
                                                                            </div>
                                    <div class="analytics-body" id="sharpe-analysis">
                                        <div class="analysis-detail">Calculating...</div>
                                    </div>
                                </div>

                                <div class="analytics-card watermark-card">
                                    <div class="analytics-header">
                                        <span class="analytics-title">üíß Watermark History</span>
                                                                            </div>
                                    <div class="analytics-body" id="watermark-history-analysis">
                                        <div class="analysis-detail">Select a market to analyze...</div>
                                    </div>
                                    <div id="current-watermark-status"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h4>Understanding Strategies</h4>
                    <div class="valuation-guide four-col">
                        <div class="guide-item pt-guide">
                            <strong>PT (Principal Token)</strong>
                            <ul>
                                <li>Receive underlying at maturity for a fixed discount</li>
                                <li>Guaranteed APY regardless of future yield changes</li>
                                <li>Best when you expect yields to drop</li>
                            </ul>
                        </div>
                        <div class="guide-item yt-guide">
                            <strong>YT (Yield Token)</strong>
                            <ul>
                                <li>Receive all yield from underlying until maturity</li>
                                <li>Leveraged exposure to yield rates</li>
                                <li>Best when you expect yields to rise or stay high</li>
                            </ul>
                        </div>
                        <div class="guide-item lp-guide">
                            <strong>LP (Liquidity Provider)</strong>
                            <ul>
                                <li>Earn swap fees from PT/SY trading</li>
                                <li>Often receive bonus incentives (PENDLE, points)</li>
                                <li>Balanced risk: part fixed, part variable yield</li>
                            </ul>
                        </div>
                        <div class="guide-item loop-guide">
                            <strong>Loop PT (Leveraged)</strong>
                            <ul>
                                <li>Use PT as collateral on Aave/Morpho</li>
                                <li>Amplify fixed APY through leverage</li>
                                <li>Higher returns but liquidation risk</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Strategy Compare -->
            <section id="compare-calculator" class="calculator-section">
                <div class="section-header">
                    <div class="section-header-main">
                        <h2>Strategy Comparison</h2>
                        <p>Compare PT vs YT vs LP vs Holding across different APY scenarios</p>
                    </div>
                    <button class="nav-link-btn" id="back-to-calculator-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Back to Analysis
                    </button>
                </div>

                <!-- No Market Selected Prompt for Compare -->
                <div class="no-market-prompt" id="no-market-prompt-compare">
                    <div class="prompt-card">
                        <div class="prompt-icon-large">‚öñÔ∏è</div>
                        <h3>Select a Market to Compare Strategies</h3>
                        <p>Choose a market from Live Markets to compare PT, YT, LP, and Hold strategies with real market data.</p>
                        <button class="select-market-btn" id="select-market-btn-compare">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            Browse Live Markets
                        </button>
                        <p class="prompt-hint">Or enter custom values below to compare manually</p>
                    </div>
                </div>

                <div class="selected-market-banner" id="compare-market-banner" style="display: none;">
                    <div class="banner-content">
                        <img id="compare-banner-icon" src="" alt="" class="banner-icon">
                        <div class="banner-info">
                            <span class="banner-name" id="compare-banner-name">-</span>
                            <span class="banner-expiry" id="compare-banner-expiry">-</span>
                        </div>
                    </div>
                    <div class="banner-actions">
                        <button class="banner-action-btn" id="analyze-in-calculator">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <path d="M9 17v-2a4 4 0 0 1 4-4h4"/>
                                <path d="M13 7l4 4-4 4"/>
                            </svg>
                            View Analysis
                        </button>
                    </div>
                </div>

                <div class="calculator-grid wide">
                    <div class="input-card">
                        <h3>Scenario Parameters</h3>

                        <div class="input-row">
                            <div class="input-group">
                                <label for="cmp-pt-price">PT Price</label>
                                <div class="input-wrapper">
                                    <input type="number" id="cmp-pt-price" value="0.95" step="0.001" min="0" max="1">
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="cmp-yt-price">YT Price</label>
                                <div class="input-wrapper">
                                    <input type="number" id="cmp-yt-price" value="0.05" step="0.001" min="0" max="1">
                                </div>
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-group">
                                <label for="cmp-days">Days to Maturity</label>
                                <div class="input-wrapper">
                                    <input type="number" id="cmp-days" value="90" step="1" min="1" max="730">
                                    <span class="input-suffix">days</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="cmp-investment">Investment</label>
                                <div class="input-wrapper">
                                    <input type="number" id="cmp-investment" value="10000" step="100" min="0">
                                    <span class="input-suffix">USD</span>
                                </div>
                            </div>
                        </div>

                        <div class="input-group">
                            <label for="cmp-underlying-apy">Scenario: Future APY</label>
                            <input type="range" id="cmp-underlying-apy" value="25" min="0" max="50" step="0.5">
                            <div class="range-labels">
                                <span>0%</span>
                                <span class="range-value" id="cmp-apy-display">25%</span>
                                <span>50%</span>
                            </div>
                        </div>

                        <div class="breakeven-indicator">
                            <span>Break-even APY:</span>
                            <strong id="cmp-breakeven-apy">21.55%</strong>
                        </div>
                    </div>
                </div>

                <div class="comparison-results">
                    <div class="comparison-card pt-card">
                        <div class="card-header">
                            <h4>Buy PT</h4>
                            <span class="strategy-tag">Fixed Yield</span>
                        </div>
                        <div class="card-body">
                            <div class="main-result">
                                <span class="label">Final Value</span>
                                <span class="value" id="cmp-pt-final">$10,526.32</span>
                            </div>
                            <div class="sub-results">
                                <div class="sub-result">
                                    <span>Fixed APY</span>
                                    <span id="cmp-pt-apy">21.55%</span>
                                </div>
                                <div class="sub-result">
                                    <span>Profit</span>
                                    <span class="profit" id="cmp-pt-profit">+$526.32</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="verdict" id="cmp-pt-verdict">Guaranteed return</span>
                        </div>
                    </div>

                    <div class="comparison-card yt-card">
                        <div class="card-header">
                            <h4>Buy YT</h4>
                            <span class="strategy-tag">Long Yield</span>
                        </div>
                        <div class="card-body">
                            <div class="main-result">
                                <span class="label">Final Value</span>
                                <span class="value" id="cmp-yt-final">$11,682.19</span>
                            </div>
                            <div class="sub-results">
                                <div class="sub-result">
                                    <span>Leverage</span>
                                    <span id="cmp-yt-leverage">20x</span>
                                </div>
                                <div class="sub-result">
                                    <span>Profit</span>
                                    <span class="profit" id="cmp-yt-profit">+$1,682.19</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="verdict" id="cmp-yt-verdict">Profitable if APY > 21.55%</span>
                        </div>
                    </div>

                    <div class="comparison-card lp-card">
                        <div class="card-header">
                            <h4>Provide LP</h4>
                            <span class="strategy-tag">Balanced</span>
                        </div>
                        <div class="card-body">
                            <div class="main-result">
                                <span class="label">Final Value</span>
                                <span class="value" id="cmp-lp-final">$10,450.00</span>
                            </div>
                            <div class="sub-results">
                                <div class="sub-result">
                                    <span>LP APY</span>
                                    <span id="cmp-lp-apy">18.25%</span>
                                </div>
                                <div class="sub-result">
                                    <span>Profit</span>
                                    <span class="profit" id="cmp-lp-profit">+$450.00</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="verdict" id="cmp-lp-verdict">Swap fees + PT yield</span>
                        </div>
                    </div>

                    <div class="comparison-card hold-card">
                        <div class="card-header">
                            <h4>Hold Underlying</h4>
                            <span class="strategy-tag">Baseline</span>
                        </div>
                        <div class="card-body">
                            <div class="main-result">
                                <span class="label">Final Value</span>
                                <span class="value" id="cmp-hold-final">$10,616.44</span>
                            </div>
                            <div class="sub-results">
                                <div class="sub-result">
                                    <span>Yield Earned</span>
                                    <span id="cmp-hold-yield">$616.44</span>
                                </div>
                                <div class="sub-result">
                                    <span>Period Return</span>
                                    <span id="cmp-hold-return">6.16%</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <span class="verdict" id="cmp-hold-verdict">Variable yield</span>
                        </div>
                    </div>
                </div>

                <div class="winner-banner" id="winner-banner">
                    <span class="winner-label">Best Strategy:</span>
                    <span class="winner-name" id="winner-name">YT</span>
                    <span class="winner-advantage" id="winner-advantage">+$1,155.87 vs next best</span>
                </div>

                <div class="chart-container">
                    <h4>Returns vs Future APY</h4>
                    <canvas id="comparison-chart"></canvas>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>Made with love by <a href="https://x.com/0xcarnation" target="_blank">0xcarnation</a>. Powered by Claude.</p>
            <p class="disclaimer">Calculations are estimates. Not financial advice. DYOR.</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    <script src="app.js"></script>
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
